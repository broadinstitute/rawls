{{with $environment := env "ENVIRONMENT"}}
{{$keyname := printf "secret/dsde/%s/rawls/rawls-compose.yaml" $environment}}
{{with vault $keyname}}

app:
  image: {{.Data.app_image}}
  {{.Data.app_dns}}
  {{.Data.app_volumes}}
  {{.Data.app_ports}}
proxy:
  extends:
    file: proxy-compose.yaml
    service: proxy
  links:
    - app:app
  environment:
    PROXY_URL: http://app:8080/
    PROXY_URL2: http://app:8080/api
    PROXY_URL3: http://app:8080/register

{{end}}
{{end}}
